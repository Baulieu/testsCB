%YAML:1.0

#####################################
###      General parameter       ###
#####################################

#Source selection
Source:
   input: 1                                                  # 0 = Camera   1 = SVO file.
   resolution: 1                                             # if source=camera, select quality (0=VGA, 1= HD720, 2=HD1080..) 
   path:  "../Svo_files/test4a"                              # if source= SVO file                                       
   svo_fps: 60                                               # FPS of the SVO files 

#SDK parameters
Zed:
   mode: 0                                                   # 1 = mode::PERFORMANCE , 0= mode::QUALITY     
   sensing_mode: 1                                           # 1 = sensing::mode::FULL, 0=sensing::mode::RAW
   clamp_value: 300000                                       # Maximum distance of depth estimation (mm)
   reliability: 96                                           # a value in [1,100]. A lower value means more confidence and precision (but less density)
   depth_square: 3                                           # number of pixel around the center of the target took into account to compute an average depth

#####################################
###      Detection function       ###
#####################################

### Detection on the full picture ###

#Preparation of the picture
Pre_treatement:
   clahe_parameter:3                                         # [TBC]

#Initial parameter of the background substrator function for the full picture
MOG2_full: #TBC
   history: 20.0                                             # Number of frame in the history during which a target shouldn't move to be considered as background !!!WARNING!!! Very depend of FPS !!!WARNING!!!
   backgroundRatio: 0.9                                      # Threshold defining whether the component is significant enough to be included into the background model
   fVarInit: 15                                              # Initial variance for the newly generated components.
   fCT: 0.5                                                  # Complexity reduction parameter. This parameter defines the number of samples needed to accept to prove the component exists
   varThreshold: 16                                          # Threshold for the squared Mahalanobis distance that helps decide when a sample is close to the existing components (corresponds to Tg)
   nmixtures: 3                                              # Number of Gaussian mixtures.
   nShadowDetection: 127                                     # Shadow parameter (cf. below for more detail)
   shadowvalue: 0                                            # Shadow parameter (cf. below for more detail)
   fTau: 0.5                                                 # Shadow parameter (cf. below for more detail)

#Smoothing of the detection matrix
Smoothing_full:
   morphology_1:70                                           # Completion of empty pixel in the shape lenght wise
   morphology_2:70                                           # Completion of empty pixel in the shape width wise
   blur_matrix: 10                                           # Blur parameter (befor and after detection) more effect if greater
   erosion_size:2                                            # Number of px erodds away from the boundaries of foreground object  
   dilatation_size: 2                                        # Just the opposite of ersosion_size 
   nbr_erosion:2                                             # Number of erosion
   nbr_dilatation: 2                                         # Number of dilatation

### Focused detection on regions of interest ###

# General parameter
ROI:   
   not_tracked: 10                                           # Number of frame during which the focused detection on a specific region is still active  

#Preparation of the picture
Pre_treatement_ROI:
   clahe_parameter: 3                                        # [TBC]

#Initial parameter of the background substrator function for identified region of interest 
MOG2_ROI: #TBC
   history: 20                                               # Au bout de cb d'image on considère une cible qui n'a plus bougée comme faisant partie du fond.
   backgroundRatio: 0.9                                      # Threshold defining whether the component is significant enough to be included into the background model
   fVarInit: 15                                              # Initial variance for the newly generated components.
   fCT: 0.5                                                  # Complexity reduction parameter. This parameter defines the number of samples needed to accept to prove the component exists
   varThreshold: 16                                          # Threshold for the squared Mahalanobis distance that helps decide when a sample is close to the existing components (corresponds to Tg)
   nmixtures: 3                                              # Number of Gaussian mixtures.
   nShadowDetection: 127                                     # Shadow parameter (cf. below for more detail)
   shadowvalue: 0                                            # Shadow parameter (cf. below for more detail)
   fTau: 0.5                                                 # Shadow parameter (cf. below for more detail)

#Initial parameter of the background substrator function for identified region of interest on the depth map 
MOG2_ROI_depth_map: #TBC
   history: 20                                               # Au bout de cb d'image on considère une cible qui n'a plus bougée comme faisant partie du fond.
   backgroundRatio: 0.9                                      # Threshold defining whether the component is significant enough to be included into the background model
   fVarInit: 15                                              # Initial variance for the newly generated components.
   fCT: 0.5                                                  # Complexity reduction parameter. This parameter defines the number of samples needed to accept to prove the component exists
   varThreshold: 16                                          # Threshold for the squared Mahalanobis distance that helps decide when a sample is close to the existing components (corresponds to Tg)
   nmixtures: 3                                              # Number of Gaussian mixtures.
   nShadowDetection: 127                                     # Shadow parameter (cf. below for more detail)
   shadowvalue: 0                                            # Shadow parameter (cf. below for more detail)
   fTau: 0.5                                                 # Shadow parameter (cf. below for more detail)

#Smoothing of the detection matrix
Smoothing_ROI:
   morphology_1:70                                           # Completion of empty pixel in the shape lenght wise
   morphology_2:70                                           # Completion of empty pixel in the shape width wise
   taille_matrice: 10    #TBC A changer en blur_matrix       # Blur parameter (befor and after detection) more effect if greater
   erosion_size:2                                            # Number of px erodds away from the boundaries of foreground object  
   dilatation_size: 2                                        # Just the opposite of ersosion_size 
   nbr_erosion:2                                             # Number of erosion
   nbr_dilatation: 2                                         # Number of dilatation

#Smoothing of the detection matrix (depth map)
Smoothing_depth_map:
   morphology_1:70                                           # Completion of empty pixel in the shape lenght wise
   morphology_2:70                                           # Completion of empty pixel in the shape width wise
   taille_matrice:10    #TBC A changer en blur_matrix        # Blur parameter (befor and after detection) more effect if greater
   erosion_size:2                                            # Number of px erodds away from the boundaries of foreground object  
   dilatation_size:2                                         # Just the opposite of ersosion_size 
   nbr_erosion:2                                             # Number of erosion
   nbr_dilatation:2                                          # Number of dilatation

#####################################
###      Confidence Index         ###
#####################################

#Noise Index parameter
Noise_Index:
   size_min: 5  

#####################################
###      Environment Index        ###
#####################################

### Function and threshold detailed in function.cpp
### Affine function for each parameter in tools.cpp

#####################################
###        Vector Cleaning        ###
#####################################

# Cleaning of the vector 
Cleaning:
   erase_target: 30                                          # Idle time before deletion of a target
   erase_traj: 20                                            # Number of second of position keept in memory for each target


#Display parameter in the video / picture sent to the serveur
Display:
   id: 1                                                     # Display target id 
   image: 1    #what is it ?                                 # Display all  1 = yes, 0 = non
   trajectory: 1                                             # display trajectory
   depth: 1                                                  # display depth
   center: 0                                                 # display center
   rectangle:1                                               # display rectangle
   contours: 0                                               # display target outline
   running_time: 1          #what is it ?                    # display time
   execution_time: 0                                         # Display 1 loop execution time (console)
   confidence_index: 1                                       # Diplay confidence index
   affinity_index: 1                                         # Diplay affinity index
   noise_index: 1                                            # Diplay noise index
   environment_index: 1                                      # Diplay environment index


#####################################
###       Server paramaters       ###
#####################################

Server:
   url_data: "http://www.cerbair.com/panel/alerts/n.php"     # URL of the data / picture reception page 
   url_COM: "http://www.cerbair.com/panel/alerts/COM.php"    # URL of the communicaiton page
   send_data_rate:5                                          # Time (in s) between batchs of data, picture and video sent on the server (n.php and video_n.php)
   send_COM_rate: 1                                          # Time (in s) between batchs sent on the server (COM.php) 
   compression_image: 100                                    # % of compression

#####################################
###       Other paramaters       ###
#####################################

# hardware reboot in case of bug
Other:
   reboot: 10                                                # Maximun number of reboot
   launch_reboot: 0                                          # Automatic reboot if 1
   record_video:1                                            # record a video if 1

#####################################
###     NOT TO BE MODIFIED        ###
#####################################

# Internal parameter
new_params: 0                                                # Reload parameters if 1                 


#####################################
###          BAULIEU              ###
#####################################

Coefs:
   #affinity
   coef1: 10.0                                              # time
   coef2: 10.0                                              # distance pixel.                                               
   coef3: 10.0                                              # distance to predict pixel.
   coef4: 10.0                                              # distance m 
   coef5: 10.0                                              # distance to predict m
   coef6: 0                                                 # width diff m
   coef7: 0                                                 # length diff m
   coef8: 0.0                                               # hog distance
   coef9: 0                                                 # hue diff
   coef10: 0                                                # value diff
   coef11: 0                                                # saturation diff
   coef12: 10.0                                             # size coeff 

   # caracterisaton
   coef13: 200                                              # size coeff    
   coef14: 10                                               # average affinity 
   coef15: 30                                               # average pixel speed diff 
   coef16: 10                                               # average pixel speed 

Params:
   #affinity
   param1: 6000                                            # temps max entre 2 targets si > 6s aff_tim = 0
   param2: 300                                             # distance pixel max. 
   param3: 200                                             # distance to predict pixel max.
   param4: 2                                               # distance 3d max.
   param5: 2                                               # distance 3d to predict max.
   param6: 1                                               # max width diff (m)
   param7: 1                                               # max length diff (m)
   param8: 200                                             # hog distance max.
   param9: 60                                              # max hue diff 
   param10: 30                                             # max value diff
   pram11: 30                                              # max saturation diff 

   # caracterisation
   param15: 30                                             # Average pixel speed 
   param16: 10                                             # max abs(pixel speed -average_pixel_speed)
   param17: 1                                              # average speed (1m/s)
   param18: 4                                              # max abs(speed - average speed) 


#####################################
###      Detailled comments       ###
#####################################


#ZED PARAMS
#mode::PERFORMANCE:   Fastest mode, also requires less GPU memory, the disparity map is less detailed.
#mode::QUALITY:       Better quality mode, the disparity map is more precise.
#sensing::MODE::FULL: Occlusion filling, edge sharpening, advanced post-filtering. Application example : Refocusing, Multi-view generation.
#sensing::MODE::RAW:  Structure conservative, no occlusion filling. Application example : Obstacle detection, 3D reconstructions.      
#clamp_value:         Set the maximum distance of depth/disarity estimation (all values after this limit will be reported as TOO_FAR value

#MOG2
#int nmixtures : Maximum allowed number of mixture components. Actual number is determined dynamically per pixel.
#float backgroundRatio : Threshold defining whether the component is significant enough to be included into the background model
# cf=0.1 => TB=0.9 is default. For alpha=0.001, it means that the mode shoul dexist for approximately 105 frames before it is considered foreground.
#float varThresholdGen : Threshold for the squared Mahalanobis distance that helps decide when a sample is close to the existing components.
# If it is not close to any component, a new component is generated. 3 sigma => Tg=3*3=9 is default. A smaller Tg value generates more components.
# A higher Tg value may result in a small number of components but they can grow too large.
#float fVarInit : Initial variance for the newly generated components. It affects the speed of adaptation.
# The parameter value is based on your estimate of the typical standard deviation from the images. OpenCV uses 15 as a reasonable value.
#float fVarMin : Parameter used to further control the variance.
#float fVarMax : Parameter used to further control the variance.
#float fCT : Complexity reduction parameter. This parameter defines the number of samples needed to accept to prove the component exists.
# CT=0.05 is a default value for all the samples. By setting CT=0 you get an algorithm very similar to the standard Stauffer&Grimson algorithm.
#uchar nShadowDetection :  The value for marking shadow pixels in the output foreground mask. Default value is 127.
#float fTau :  Shadow threshold. The shadow is detected if the pixel is a darker version of the background. 
#Tau is a threshold defining how much darker the shadow can be. Tau= 0.5 means that if a pixel is more than twice darker then it is not shadow
